<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-CA" xml:lang="en-CA"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="alice, (AHC)">
<meta name="dcterms.date" content="2024-01-02">

<title>Alice in Motion (2)</title>
<style class="anchorjs"></style><style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="index_files/clipboard.min.js"></script>
<script src="index_files/quarto.js"></script>
<script src="index_files/popper.min.js"></script>
<script src="index_files/tippy.umd.min.js"></script>
<script src="index_files/anchor.min.js"></script>
<link href="index_files/tippy.css" rel="stylesheet">
<link href="index_files/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/bootstrap.min.js"></script>
<link href="index_files/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


<script src="index_files/page-script.js"></script></head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Alice in Motion (2)</h1>
<p class="subtitle lead">Personal transit data in R</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>alice, (AHC) </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 2, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="code-availability" class="level3">
<h3 class="anchored" data-anchor-id="code-availability">Code availability<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#code-availability" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h3>
<p>Find the code (and a version of the data) used to generate this on my <a href="https://github.com/legallyahc/transit">github</a>.</p>
</section>
<section id="packages" class="level3">
<h3 class="anchored" data-anchor-id="packages">Packages<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#packages" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(c("tidyverse", "googlesheets4"))</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="adventures-in-public-transport" class="level1">
<h1>Adventures in Public Transport</h1>
<p>One of my favourite feelings is <em>adventure</em>. The joy of 
discovery is unparalleled, the sense of gaining knowledge and then 
remembering it for all that is to come. That may be what drew me to my 
love of transit. There is so much information available, some known and 
others unknown, and I can observe it at the scale of my individual 
experience.</p>
<p>One of my close friends began recording her bus trips in a Google 
Sheet in April 2022. She shared this with me in the fall when I noticed 
her doing a quick data entry on the bus we caught together. She shared 
that you can identify the year a bus entered service with the STM 
(Montreal’s transit agency) by the first two digits of its 
identification number. For example, a bus labelled 38-020 entered 
service in 2018 (calculated from 1980, so 1980 + 38). This small nugget 
of information led to me following in her example and recording my own 
transit trip data. I frequently use <a href="https://transitapp.com/">Transit</a>
 and was beginning to submerging myself in world of geospatial data, so 
it seemed a logical step to start making observations of my own transit 
patterns. Due to its relative ease (and low cost of ‘free’) I recorded 
my trips in Google Sheets which means that we begin with harvesting that
 data!</p>
<section id="data-from-google-sheets" class="level2">
<h2 class="anchored" data-anchor-id="data-from-google-sheets">Data from Google Sheets<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#data-from-google-sheets" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>transit_url <span class="ot">&lt;-</span> <span class="st">"https://docs.google.com/spreadsheets/d/SPREADSHEET_ID/edit#gid=SHEET_ID"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># As provided by `googlesheets4::`</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>transit <span class="ot">&lt;-</span> googlesheets4<span class="sc">::</span><span class="fu">read_sheet</span>(transit_url, <span class="at">sheet =</span> <span class="dv">1</span>, <span class="at">col_types =</span> <span class="st">"Dcccccdcccclcc"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Read in the daily transit data sheet, adding some simple classification in `col_types`</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>key <span class="ot">&lt;-</span> googlesheets4<span class="sc">::</span><span class="fu">read_sheet</span>(transit_url, <span class="at">sheet =</span> <span class="dv">2</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Read in the key sheet</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you want to replicate this exact process, you will likely need to alter the <code>col_types</code> information, allow <code>googlesheets4::</code>
 to interface with your Google account, and tailor it to your own data. 
It was incredibly straightforward for me which was quite a relief!</p>
</section>
<section id="data-cleaning" class="level2">
<h2 class="anchored" data-anchor-id="data-cleaning">Data Cleaning<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#data-cleaning" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h2>
<p>To keep data recording simple (at the beginning), I started by 
tracking the central pieces of my journey: the date, what time I got on 
and off the vehicle, what line, the stop I boarded and alighted at, and 
the unit number. Later, I added information about whether I transferred 
to another vehicle, what mode I (personally) classify it as, and some 
Google Sheets wizardry (contributed by <a href="https://laurr.neocities.org/">Laura</a>)
 to check if I had ridden that specific vehicle before. This resulted in
 14 (15 for 2024) variables that can be manipulated into something more 
useful for visualization and analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If you import your data directly from Google Sheets, you don't need these next two lines, but if following with my data, keep it present.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>transit <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"transit.csv"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>key <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"key.csv"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(transit) <span class="co"># All 15 of those original variables</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Date"           "Time Boarded"   "Line"           "Name"          
 [5] "Direction"      "Bus"            "Ridden before?" "Stop Boarded"  
 [9] "Stop Alighted"  "Time Alighted"  "Comments"       "Transfer"      
[13] "Mode"           "Rating (0-7)"   "Other_notes"   </code></pre>
</div>
</div>
<p>My data has a few quirks. I’ve had difficulties in the past dealing 
with time, date, datetime, and duration data in R (I am no stranger to <code>lubridate::</code>’s handy guides) and this data has a lot of that. Additionally, the daily transit data (stored in <code>origin.csv</code>) has includes agency and line number information stored in the <code>Line</code> column! Let’s wrangle this data into something usable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>transit <span class="ot">&lt;-</span> transit <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># woo getting time to parse neatly -------------------------------------------</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (not dealing with time zones. for understandable reasons. forgive me.)</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Time Boarded</span><span class="st">`</span> <span class="ot">=</span> hms<span class="sc">::</span><span class="fu">parse_hm</span>(<span class="st">`</span><span class="at">Time Boarded</span><span class="st">`</span>), </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Time Alighted</span><span class="st">`</span> <span class="ot">=</span> hms<span class="sc">::</span> <span class="fu">parse_hm</span>(<span class="st">`</span><span class="at">Time Alighted</span><span class="st">`</span>),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fancy 'did a ride go past midnight?' detector for correct duration values --</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this breaks for rides &gt; 24hr long</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Duration =</span> <span class="fu">ifelse</span>( </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>      (<span class="fu">as.numeric</span>(<span class="st">`</span><span class="at">Time Alighted</span><span class="st">`</span>) <span class="sc">-</span> <span class="fu">as.numeric</span>(<span class="st">`</span><span class="at">Time Boarded</span><span class="st">`</span>)) <span class="sc">&gt;=</span> <span class="dv">0</span>, <span class="co"># This tests if the duration went past midnight</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">dseconds</span>(<span class="fu">as.numeric</span>(<span class="st">`</span><span class="at">Time Alighted</span><span class="st">`</span>) <span class="sc">-</span> <span class="fu">as.numeric</span>(<span class="st">`</span><span class="at">Time Boarded</span><span class="st">`</span>)), <span class="co"># if it didnt it's all good</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">duration</span>(<span class="fu">as.numeric</span>(<span class="st">`</span><span class="at">Time Alighted</span><span class="st">`</span>) <span class="sc">-</span> <span class="fu">as.numeric</span>(<span class="st">`</span><span class="at">Time Boarded</span><span class="st">`</span>) <span class="sc">+</span> <span class="dv">86400</span>) <span class="co"># if it did it has to add 1 days worth of seconds</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Datetime variables for neat visualisations in the future -------------------</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">DT_Boarded =</span> <span class="fu">ymd_hms</span>(<span class="fu">paste0</span>(Date, <span class="st">" "</span>, <span class="fu">as.character</span>(<span class="st">`</span><span class="at">Time Boarded</span><span class="st">`</span>))), </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">DT_Alighted =</span> <span class="fu">ymd_hms</span>(<span class="fu">paste0</span>(Date, <span class="st">" "</span>, <span class="fu">as.character</span>(<span class="st">`</span><span class="at">Time Alighted</span><span class="st">`</span>))), </span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Like the duration code above, this checks if a ride went past midnight to adjust `DT_Alighted`</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">DT_Alighted =</span> <span class="fu">if_else</span>(</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>      (<span class="fu">as.numeric</span>(<span class="st">`</span><span class="at">Time Alighted</span><span class="st">`</span>) <span class="sc">-</span> <span class="fu">as.numeric</span>(<span class="st">`</span><span class="at">Time Boarded</span><span class="st">`</span>)) <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.na</span>(<span class="st">`</span><span class="at">Time Alighted</span><span class="st">`</span>), </span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Returns TRUE if duration is positive OR if it's missing `Time Alighted`</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>      DT_Alighted, <span class="co"># If duration is positive (TRUE) returns the established `DT_Alighted`</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>      DT_Alighted <span class="sc">+</span> <span class="dv">86400</span> <span class="co"># If neg (FALSE) adds a day to `DT_Alighted`</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This deals with the pesky time data, but creating all those datetime 
variables will be helpful for any future visualizations or analysis! 
Now, let’s sort the combined agency and line number column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>transit <span class="ot">&lt;-</span> transit <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># String stuff for separating `Agency` and `Line_num`, both contained in `Line`</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>      <span class="co"># see `key` to decode `Agency`</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>      <span class="co"># "i paid for the whole tidyverse and goddammit i'll use it all"</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Agency =</span> <span class="fu">if_else</span>(</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(Line, <span class="st">"[:alpha:]"</span>, <span class="at">negate =</span> T), <span class="co"># Checks if `Line` has any letters</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">"STM"</span>, <span class="co"># If not (see the `negate = T`) it's the STM (yeah i formatted my data with the STM as default. and that's legacy, baby!)</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_split_i</span>(Line, <span class="st">"_"</span>, <span class="dv">1</span>) <span class="co"># If it does contain alpha chars it splits the string at "_" and keeps the first bit</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">Line_num =</span> <span class="fu">if_else</span>(</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Same dance as it ever was,</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(Line, <span class="st">"[:alpha:]"</span>, <span class="at">negate =</span> T), </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>      Line, <span class="co"># If no letters, return `Line` bc again, STM default</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_split_i</span>(Line, <span class="st">"_"</span>, <span class="dv">2</span>) <span class="co"># If letters, return everything after "_"</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Perfect!</p>
<p>Now we have everything in a very ready and easy to use form. Let’s play!</p>
</section>
<section id="monthly-tilable-breakdowns" class="level2">
<h2 class="anchored" data-anchor-id="monthly-tilable-breakdowns">Monthly tilable breakdowns<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#monthly-tilable-breakdowns" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h2>
<p>So, for my <a href="https://woah.encours.xyz/">blog</a>, I like to 
include breakdowns of the transit I’ve taken that month. Let’s make a 
cute way to generate that based on our selection:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>start_date <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="st">"2023-07-08"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>end_date <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="st">"2023-12-11"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>monthly <span class="ot">&lt;-</span> transit <span class="sc">%&gt;%</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(DT_Alighted <span class="sc">&gt;=</span> start_date <span class="sc">&amp;</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>         DT_Alighted <span class="sc">&lt;=</span> end_date) <span class="sc">%&gt;%</span> </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Month =</span> <span class="fu">ifelse</span>(DT_Alighted <span class="sc">&lt;</span> <span class="fu">ymd</span>(<span class="st">"2023-12-08"</span>), <span class="dv">5</span>, <span class="dv">6</span>),</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Month =</span> <span class="fu">ifelse</span>(DT_Alighted <span class="sc">&lt;</span> <span class="fu">ymd</span>(<span class="st">"2023-11-08"</span>), <span class="dv">4</span>, Month),</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Month =</span> <span class="fu">ifelse</span>(DT_Alighted <span class="sc">&lt;</span> <span class="fu">ymd</span>(<span class="st">"2023-10-08"</span>), <span class="dv">3</span>, Month),</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">Month =</span> <span class="fu">ifelse</span>(DT_Alighted <span class="sc">&lt;</span> <span class="fu">ymd</span>(<span class="st">"2023-09-08"</span>), <span class="dv">2</span>, Month),</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Month =</span> <span class="fu">ifelse</span>(DT_Alighted <span class="sc">&lt;</span> <span class="fu">ymd</span>(<span class="st">"2023-08-08"</span>), <span class="dv">1</span>, Month)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Excludes all transit since home, i.e. exclusively non-north american transit</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Kinda bodgey way to do month divisions. Sorry.</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing their overall stat output</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(monthly <span class="sc">%&gt;%</span> <span class="co"># doing this all in an rbind() is kinda yucky, thank you for noticing.</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fwiw i use rbind here to get the individual monthly data and total in the same tibble.</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Month) <span class="sc">%&gt;%</span> </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Trips</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">n</span>(),</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Total travel time (hr)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">sum</span>(Duration) <span class="sc">/</span> <span class="dv">3600</span>, <span class="dv">2</span>),</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Unique Lines</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">n_distinct</span>(Line),</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Unique Vehicles</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">n_distinct</span>(Bus),</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Unique destinations</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">n_distinct</span>(<span class="st">`</span><span class="at">Stop Boarded</span><span class="st">`</span>, <span class="st">`</span><span class="at">Stop Alighted</span><span class="st">`</span>),</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">Modes =</span> <span class="fu">n_distinct</span>(Mode)), </span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>  monthly <span class="sc">%&gt;%</span> </span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Trips</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">n</span>(),</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Total travel time (hr)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">sum</span>(Duration) <span class="sc">/</span> <span class="dv">3600</span>, <span class="dv">2</span>),</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Unique Lines</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">n_distinct</span>(Line),</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Unique Vehicles</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">n_distinct</span>(Bus),</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Unique destinations</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">n_distinct</span>(<span class="st">`</span><span class="at">Stop Boarded</span><span class="st">`</span>, <span class="st">`</span><span class="at">Stop Alighted</span><span class="st">`</span>),</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">Modes =</span> <span class="fu">n_distinct</span>(Mode)</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">Month =</span> <span class="st">"Overall"</span>)</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Trips</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Total travel time (hr)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Unique Lines</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Unique Vehicles</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Unique destinations</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Modes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">14.47</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">46</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: right;">86</td>
<td style="text-align: right;">40.38</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">10.13</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">9.43</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">9.50</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">6</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">3.25</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Overall</td>
<td style="text-align: right;">278</td>
<td style="text-align: right;">87.17</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">236</td>
<td style="text-align: right;">228</td>
<td style="text-align: right;">9</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Okay, but what if I wanted to make a fun little ‘transit wrapped’ 
style thing? Hm, let’s amalgamate some fun stats for all that now :). 
It’d be really neat to have to basically all ready to go for the New 
Year, so I could <a href="https://woah.encours.xyz/posts/wrapped.html">post it on 2023-12-31</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>start_date <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="st">"2023-01-01"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>end_date <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="st">"2023-12-31"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>yearly <span class="ot">&lt;-</span> transit <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(DT_Alighted <span class="sc">&gt;=</span> start_date <span class="sc">&amp;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>         DT_Alighted <span class="sc">&lt;=</span> end_date) <span class="co">#iirc this had some issue with not selecting the last date, make sure to double check that b4 posting (wasn't an issue as no entries on 2023-12-31)</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Overall stats</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>yearly <span class="sc">%&gt;%</span> </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at"># of Trips</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">n</span>(),</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Total Time (hr)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">sum</span>(Duration) <span class="sc">/</span> <span class="dv">3600</span>, <span class="dv">2</span>),</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Unique Agencies</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">n_distinct</span>(Agency),</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Unique Lines</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">n_distinct</span>(Line),</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Unique Vehicles</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">n_distinct</span>(Bus),</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Unique destinations</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">n_distinct</span>(<span class="st">`</span><span class="at">Stop Boarded</span><span class="st">`</span>, <span class="st">`</span><span class="at">Stop Alighted</span><span class="st">`</span>),</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">Modes =</span> <span class="fu">n_distinct</span>(Mode)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th"># of Trips</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Total Time (hr)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Unique Agencies</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Unique Lines</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Unique Vehicles</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Unique destinations</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Modes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">650</td>
<td style="text-align: right;">168.1</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">183</td>
<td style="text-align: right;">558</td>
<td style="text-align: right;">478</td>
<td style="text-align: right;">13</td>
</tr>
</tbody>
</table>


</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Most ridden vehicle</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>yearly <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="st">`</span><span class="at">Ridden before?</span><span class="st">`</span> <span class="sc">==</span> <span class="fu">max</span>(yearly<span class="sc">$</span><span class="st">`</span><span class="at">Ridden before?</span><span class="st">`</span>, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  .[<span class="dv">1</span>,] <span class="sc">%&gt;%</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Line, Bus) <span class="sc">%&gt;%</span> </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Line</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Bus</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">AT_Inner</td>
<td style="text-align: left;">NB4028</td>
</tr>
</tbody>
</table>


</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Most ridden line</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>yearly <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Line) <span class="sc">%&gt;%</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">trips =</span> <span class="fu">n</span>()</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(trips <span class="sc">==</span> <span class="fu">max</span>(trips)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Line</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">trips</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">87</td>
</tr>
</tbody>
</table>


</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Most common trip</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>stopsandtrips <span class="ot">&lt;-</span> yearly <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Stop Boarded</span><span class="st">`</span>, <span class="st">`</span><span class="at">Stop Alighted</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">trips =</span> <span class="fu">n</span>()</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>stopsandtrips <span class="sc">%&gt;%</span> </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(trips <span class="sc">==</span> <span class="fu">max</span>(stopsandtrips<span class="sc">$</span>trips)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Stop Boarded</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Stop Alighted</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">trips</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">des Pins / du Parc</td>
<td style="text-align: left;">des Pins / Côte-des-Neiges</td>
<td style="text-align: right;">14</td>
</tr>
</tbody>
</table>


</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Monthly trips</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>monthly_plot <span class="ot">&lt;-</span> yearly <span class="sc">%&gt;%</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Month =</span> <span class="fu">month</span>(DT_Boarded, <span class="at">label =</span> T)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Month, <span class="at">fill =</span> ..x..)) <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">stat=</span><span class="st">'count'</span>, <span class="fu">aes</span>(<span class="at">y =</span> ..count.. <span class="sc">-</span> <span class="dv">7</span>,<span class="at">label =</span> ..count..)) <span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>() <span class="sc">+</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colors =</span> <span class="fu">rainbow</span>(<span class="at">n =</span> <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Trips / Month"</span>,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span>,</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">""</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>))</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>monthly_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/wrapped-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Most ridden agency</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>agency_trips <span class="ot">&lt;-</span> yearly <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Agency) <span class="sc">%&gt;%</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">trips =</span> <span class="fu">n</span>() <span class="sc">+</span> <span class="fl">0.01</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> Agency,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> trips,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> ..x..)) <span class="sc">+</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> Agency,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> trips,</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> trips <span class="sc">-</span> <span class="fl">0.01</span>,</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="fl">1.1</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Trips per Agency"</span>,</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Trips (log10)"</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colors =</span> <span class="fu">rainbow</span>(<span class="at">n =</span> <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_logticks</span>(</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">sides =</span> <span class="st">"l"</span>,</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">outside =</span> T,</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"white"</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">clip =</span> <span class="st">"off"</span>) <span class="sc">+</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"none"</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>),</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.3</span>),</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>agency_trips</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/wrapped-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># How long was spent on the Green Line?</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>yearly <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Line <span class="sc">==</span> <span class="st">"1"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Total Duration</span><span class="st">`</span> <span class="ot">=</span> (<span class="fu">sum</span>(Duration) <span class="sc">/</span> <span class="dv">3600</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Total Duration</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">8.216667</td>
</tr>
</tbody>
</table>


</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># And let's see what it looks like if this was done based on time spent, not # of trips?</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>yearly <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Line) <span class="sc">%&gt;%</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Total Duration (hrs)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>((<span class="fu">sum</span>(Duration) <span class="sc">/</span> <span class="dv">3600</span>), <span class="dv">2</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="st">`</span><span class="at">Total Duration (hrs)</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., yearly, <span class="at">multiple =</span> <span class="st">"any"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Line, Name, <span class="st">`</span><span class="at">Total Duration (hrs)</span><span class="st">`</span>, Mode) <span class="sc">%&gt;%</span> </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Line</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Name</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Total Duration (hrs)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Mode</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">NSW_XPT</td>
<td style="text-align: left;">Overnight XPT</td>
<td style="text-align: right;">12.00</td>
<td style="text-align: left;">INTERCITY_TRAIN</td>
</tr>
<tr class="even">
<td style="text-align: left;">ICNZ_IC6501</td>
<td style="text-align: left;">Auckland - Wellington</td>
<td style="text-align: right;">10.80</td>
<td style="text-align: left;">INTERCITY_BUS</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Green Line</td>
<td style="text-align: right;">8.22</td>
<td style="text-align: left;">METRO</td>
</tr>
<tr class="even">
<td style="text-align: left;">24</td>
<td style="text-align: left;">Sherbrooke</td>
<td style="text-align: right;">6.90</td>
<td style="text-align: left;">BUS</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AMTRAK_TE</td>
<td style="text-align: left;">Texas Eagle</td>
<td style="text-align: right;">5.60</td>
<td style="text-align: left;">INTERCITY_TRAIN</td>
</tr>
<tr class="even">
<td style="text-align: left;">144</td>
<td style="text-align: left;">Av. Des Pins</td>
<td style="text-align: right;">5.40</td>
<td style="text-align: left;">BUS</td>
</tr>
<tr class="odd">
<td style="text-align: left;">VIA_CORR</td>
<td style="text-align: left;">Corridor</td>
<td style="text-align: right;">5.37</td>
<td style="text-align: left;">INTERCITY_TRAIN</td>
</tr>
<tr class="even">
<td style="text-align: left;">AMTRAK_LS</td>
<td style="text-align: left;">Lincoln Service</td>
<td style="text-align: right;">5.02</td>
<td style="text-align: left;">INTERCITY_TRAIN</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AT_70</td>
<td style="text-align: left;">Botany to Britomart via Panmure</td>
<td style="text-align: right;">4.67</td>
<td style="text-align: left;">BUS</td>
</tr>
<tr class="even">
<td style="text-align: left;">AT_GULF</td>
<td style="text-align: left;">Gulf Harbour Ferry</td>
<td style="text-align: right;">3.63</td>
<td style="text-align: left;">FERRY</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Woah! In case it wasn’t apparent, the numbers that <em>you</em> get 
with this data are very different. For some level of anonymity for 
myself, this is a subset of the true data. Let me be! If this isn’t 
enough data for whatever you’re trying to do, feel free to augment it 
with data from my <a href="https://github.com/legallyahc/ahcttd">48 hours in Toronto</a>.</p>
<p>I hope that this has been interesting and perhaps even useful to you. If it wasn’t, damn, that blows.</p>
<!-- Included for my website -->
<p><a href="https://woah.encours.xyz/what.html">Back to <em>What?</em></a></p>
</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading" id="reuse">Reuse<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#reuse" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h2><div id="quarto-reuse" class="quarto-appendix-contents"><div>MIT License</div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading" id="copyright">Copyright<a class="anchorjs-link " aria-label="Anchor" data-anchorjs-icon="" href="#copyright" style="font: 1em / 1 anchorjs-icons; padding-left: 0.375em;"></a></h2><div id="quarto-copyright" class="quarto-appendix-contents"><div>All rights reserved by alice, (AHC) 2024.</div></div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          // default icon
          link.classList.add("external");
      }
    }
});
</script>
</div> <!-- /content -->



</body></html>